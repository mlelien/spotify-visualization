<!DOCTYPE html>
<html>
    <head>
        <meta http-equiv="Content-Type" content="text/html;charset=utf-8"/>
        <title>2018 Spotify Top 100</title>
        <script src="https://d3js.org/d3.v5.min.js"></script>
    </head>
    <body>
        <svg id="radar" width="800" height="800"></svg>
        <script>
            var svg = d3.select("svg#radar");
            d3.csv("./top2018.csv").then( function(data) {
                const width = 800;
                const height = 800;
                const xc = width/2;
                const yc = height/2;
                const r = 300;
                const textPadding = 30;
                const lineScale = d3.scaleOrdinal(d3.schemeSpectral);
                const axisWidth = 5;
                // const radarScale = d3.scaleSequential(d3.interpolateViridis).domain([0,100]);
                var category = [
                    "danceability", 
                    // "energy",
                    // "loudness", 
                    "speechiness",
                    "energy",
                    "acousticness",
                    // "instrumentalness",
                    "valence",
                    "liveness",
                    // "valence",
                    // "tempo"
                ];
                console.log(category);
                const level = category.length;

                var axis = svg.append("g")
                    .selectAll(".axis")
                    .data(category)
                    .enter()
                    .append("g")
                    .attr("class", "axis");
                axis.append("line")
                    .attr("x1", xc)
                    .attr("y1", yc)
                    .attr("x2", function(d,i) {
                        return xc - r*Math.sin(i*2*Math.PI/level);
                    })
                    .attr("y2", function(d,i) {
                        return yc - r*Math.cos(i*2*Math.PI/level);
                    })
                    .attr("class", "line")
                    .style("stroke", "#070d59")
                    .style("stroke-width", axisWidth)
                    // .attr("opacity", 0.5)
                axis.append("text")
                    .attr("x", function(d,i) {
                        return xc - (r+textPadding)*Math.sin(i*2*Math.PI/level); 
                    })
                    .attr("y", function(d,i) {
                        return yc - (r+textPadding)*Math.cos(i*2*Math.PI/level); 
                    })
                    .attr("text-anchor", "middle")
                    .text(function(d,i){
                        return category[i];
                    })
                    .attr("font-size", 20)
                    .attr("font-family", "Courier")
                    // var test = [];
                    // var inner = [];
                    // inner.push({
                    //     "x": 1,
                    //     "y": 2
                    // });
                    // test.push(inner);
                    // console.log(test[0][0].x);
                    
                    // console.log(data[0][category[0]]);
                var allPoints = [];
                data.forEach((d,i) => {
                    // console.log(d);
                    var points = []
                    for (var j = 0; j < category.length; j++) {
                        points.push( {
                            "x": xc - d[category[j]]*Math.sin(j*2*Math.PI/level)*r,
                            "y": yc - d[category[j]]*Math.cos(j*2*Math.PI/level)*r
                        })
                        // console.log(points);
                        // points.push( [
                        //     xc - d[category[j]]*Math.sin(j*2*Math.PI/level)*r,
                        //     yc - d[category[j]]*Math.cos(j*2*Math.PI/level)*r
                        // ])
                        
                    }
                    allPoints.push(points);
                    
                });
                console.log(allPoints);
                const radarScale = d3.scaleSequential(d3.interpolateViridis).domain([100,0]);
                for(var k = 0; k < allPoints.length; k++) {
                    
                    svg.selectAll(".area")
                        .data(allPoints[k])
                        .enter()
                        .append("polygon")
                        .attr("points",function(d) { 
                            return allPoints[k].map(function(d) { 
                                return [d.x,d.y].join(","); 
                                }).join(" ");
                        })
                        .attr("stroke", radarScale(k))
                        .attr("fill", radarScale(k))
                        .style("opacity", "0.05")
                }
                console.log(radarScale(500));
                
                // svg.selectAll("polygon")
                //     .data(allPoints)
                //     .enter()
                //     .append("polygon")
                //     .attr("points", allPoints[0])
                //     .attr("stroke", "black")
                //     .style("fill", "none")
                // svg.selectAll("polygon")
                //     .data(allPoints[1])
                //     .enter()
                //     .append("polygon")
                //     .attr("points", allPoints[1])
                //     .attr("stroke", "black")
                //     .style("fill", "none")
                // console.log(allPoints[0]);
                
                    
            }).catch( e => { console.log("Error detected:" + e.message);});
            var f = d3.format("0.2s");
            document.write(
                f(1e9).replace(/G/, "B")
            );
        </script>
    </body>
</html>